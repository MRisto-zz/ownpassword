"use strict";function initPopover(){$('[data-toggle="popover"]').popover({trigger:"none",container:"body"})}function changeGlyphyconState(e,t){e.removeClass("glyphicon glyphicon-remove glyphicon-ok form-bad form-good"),t?e.addClass("glyphicon glyphicon-ok form-good"):e.addClass("glyphicon glyphicon-remove form-bad")}function alertMsg(e,t){$(e).html(""),$('<div class="alert alert-danger">').appendTo(e).html(t)}function validateEmail(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return!t.test(e)}function validatePassword(e){var t=/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}/;return!t.test(e)}function PasswordManager(){var e=this;e.passwordstrengthoptions={},e.passwordstrengthoptions.ui={container:"#pwd-container",showVerdictsInsideProgressBar:!0,viewports:{progress:".pwstrength_viewport_progress"}},e.passwordstrengthoptions.common={usernameField:"#passwordEdit-username"},e.passwordstrengthoptions.rules={activated:{wordTwoCharacterClasses:!0,wordRepetitions:!0}},e.ajaxPasswordManagerUrl=scriptPath+"ajax/PasswordManager.php",e.passwordHideContent="****",console.log(e.ajaxPasswordManagerUrl),e.userToken=$("#user-token").val(),e.getFolders=function(t){$("#createPassword").css("visibility","visible"),$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getFolders",userToken:e.userToken}}).done(function(a){$("#folders").html(""),$("#updateFolder").css("visibility","visible");for(var o=JSON.parse(a),s=0;s<o.length;s++)$('<li class="mouse-cursor-pointer">'+o[s].name+"</li>").appendTo("#folders").addClass("folder").attr("data-folder-token-id",o[s].token_id).click(function(){e.openFolder($(this))});t&&($("[data-folder-token-id="+t+"]").addClass("active"),e.showPasswordList(t))})},e.clearFolderEditValues=function(){$("#folderEdit-title").val(""),$("#folderEdit-token").val("")},e.createFolder=function(){$(".btn-folderEdit-delete").hide(),$("#folderEditModal").modal("show"),$(".btn-folderEdit-save").unbind("click"),$(".btn-folderEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"createFolder",userToken:e.userToken,title:$("#folderEdit-title").val()}}).done(function(t){console.log("ADDED Folder");var a=JSON.parse(t);e.getFolders(a),$("#folderEditModal").modal("hide")})})},e.updateFolder=function(){$("#folderEdit-title").val($(".folder.active").html()),$("#folderEdit-token").val($(".folder.active").attr("data-folder-token-id")),$("#folderEditModal").modal("show"),$(".btn-folderEdit-save").unbind("click"),$(".btn-folderEdit-delete").unbind("click"),$(".btn-folderEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"updateFolder",userToken:e.userToken,folderToken:$("#folderEdit-token").val(),title:$("#folderEdit-title").val()}}).done(function(t){console.log("UPDATED Folder");var a=$("#folderEdit-token").val();e.getFolders(a),$("#folderEditModal").modal("hide")})}),$(".btn-folderEdit-delete").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"deleteFolder",userToken:e.userToken,folderToken:$("#folderEdit-token").val()}}).done(function(t){console.log("DELETED Folder"),e.getFoldersWithDefault(),$("#folderEditModal").modal("hide")})})},e.getFoldersWithDefault=function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getDefaultFolder",userToken:e.userToken}}).done(function(t){if("null"!=t){var a=JSON.parse(t);e.getFolders(a.token_id),e.showPasswordList(a.token_id)}else $("#folders").html(""),$("#password-content").html(""),$("#createPassword").css("visibility","hidden"),$("#updateFolder").css("visibility","hidden")})},e.showPasswordList=function(t){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getPasswords",folderToken:t,userToken:e.userToken}}).done(function(t){if($("#password-content").html(""),t)for(var a=JSON.parse(t),o=0;o<a.length;o++)$("#password-content").append('<tr id="passwordParentInChange"><td>'+a[o].title+'</a></td><td><a href="'+a[o].website_url+'" target="_blank">'+a[o].website_url+"</td><td>"+a[o].username+'</td><td id="passwordInChange"><span class="password-content">'+e.passwordHideContent+'</span> <span class="glyphicon glyphicon-eye-open mouse-cursor-pointer" aria-hidden="true" data-toggle="tooltip" title="Show Password"></span></td><td id="passwordEditInChange" align="right"><span class="glyphicon glyphicon-pencil mouse-cursor-pointer" aria-hidden="true" data-toggle="tooltip" title="Edit Password"></span></td></tr>'),$("#passwordInChange").addClass("password").click(function(){e.showPassword($(this))}).removeAttr("id"),$("#passwordParentInChange").attr("data-password-token-id",a[o].token_id).removeAttr("id"),$("#passwordEditInChange").click(function(){e.updatePassword($(this))}).removeAttr("id"),$(function(){$("[data-toggle='tooltip']").tooltip()})})},e.openFolder=function(t){$(".folder").removeClass("active"),t.addClass("active"),e.showPasswordList(t.attr("data-folder-token-id"))},e.showPassword=function(t){e.getPasswordData(t,function(a){t.find(".password-content").html(a.password),setTimeout(function(){t.find(".password-content").html(e.passwordHideContent)},5e3)})},e.getPasswordData=function(t,a){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getPasswordData",userToken:e.userToken,passwordToken:t.parent().attr("data-password-token-id")}}).done(function(e){var t=JSON.parse(e);a(t)})},e.clearPasswordEditValues=function(){$("#passwordEdit-title").val(""),$("#passwordEdit-website_url").val(""),$("#passwordEdit-username").val(""),$("#passwordEdit-password").val(""),$("#passwordEdit-token").val("")},e.updatePassword=function(t){$(".btn-passwordEdit-save").unbind("click"),$(".btn-passwordEdit-delete").unbind("click"),e.getPasswordData(t,function(a){$("#passwordEditModal").modal("show"),$("#passwordEdit-title").val(a.title),$("#passwordEdit-website_url").val(a.website_url),$("#passwordEdit-username").val(a.username),$("#passwordEdit-password").val(a.password),$("#passwordEdit-token").val(t.parent().attr("data-password-token-id")),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$("#passwordEdit-password").pwstrength("destroy"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$(".btn-passwordEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"updatePassword",userToken:e.userToken,passwordToken:$("#passwordEdit-token").val(),title:$("#passwordEdit-title").val(),website_url:e.convertToUrl($("#passwordEdit-website_url").val()),username:$("#passwordEdit-username").val(),password:$("#passwordEdit-password").val()}}).done(function(t){console.log("EDITED PASSWORD"),e.openFolder($(".folder.active")),$("#passwordEditModal").modal("hide")})}),$(".btn-passwordEdit-delete").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"deletePassword",userToken:e.userToken,passwordToken:$("#passwordEdit-token").val()}}).done(function(t){console.log("DELETED PASSWORD"),e.openFolder($(".folder.active")),$("#passwordEditModal").modal("hide")})})})},e.createPassword=function(){$(".btn-passwordEdit-delete").hide(),$("#passwordEditModal").modal("show"),$(".btn-passwordEdit-save").unbind("click"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$("#passwordEdit-password").pwstrength("destroy"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$(".btn-passwordEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"createPassword",userToken:$("#user-token").val(),title:$("#passwordEdit-title").val(),website_url:e.convertToUrl($("#passwordEdit-website_url").val()),folderToken:$(".folder.active").attr("data-folder-token-id"),username:$("#passwordEdit-username").val(),password:$("#passwordEdit-password").val()}}).done(function(t){console.log("ADDED PASSWORDs"),e.openFolder($(".folder.active")),$("#passwordEditModal").modal("hide")})})},e.convertToUrl=function(e){return/^https?:\/\//i.test(e)?e:e="http://"+e}}var scripts=document.getElementsByTagName("script"),path=scripts[scripts.length-1].src.split("?")[0],scriptPath=path.split("/").slice(0,-1).join("/")+"/",authenticationManager=scriptPath+"ajax/AuthenticationManager.php";$(".message a").click(function(){$("form").animate({height:"toggle",opacity:"toggle"},"slow"),$(".messages").html("")});var usernameBool=!1,passwordBool=!1,emailBool=!1;$("#reg-username").on("input",function(){var e=$("#reg-username").val();$.ajax({method:"POST",url:authenticationManager,data:{action:"isUsernameUnique",username:e}}).done(function(t){var a=JSON.parse(t);console.log(a),changeGlyphyconState($(".reg-username-feedback"),!1),usernameBool=!1,e.length<=3?alertMsg($(".reg-username-feedback-content"),"Username ist zu kurz"):0==a?alertMsg($(".reg-username-feedback-content"),"Username ist vergeben"):(usernameBool=!0,changeGlyphyconState($(".reg-username-feedback"),!0),$(".reg-username-feedback-content").html(""))})}),$("#reg-password").on("input",function(){changeGlyphyconState($(".reg-password-feedback"),!1),console.log(validateEmail($("#reg-password").val())),passwordBool=!1,validatePassword($("#reg-password").val())?alertMsg($(".reg-password-feedback-content"),"Passwort muss mindestens 8 Stellen haben, min. 1 Groß-, 1 Kleinbuchstabe und 1 Zahl."):(passwordBool=!0,changeGlyphyconState($(".reg-password-feedback"),!0),$(".reg-password-feedback-content").html(""))}),$("#reg-email").on("input",function(){$.ajax({method:"POST",url:authenticationManager,data:{action:"isEmailUnique",email:$("#reg-email").val()}}).done(function(e){var t=JSON.parse(e);console.log(t),changeGlyphyconState($(".reg-email-feedback"),!1),console.log(validateEmail($("#reg-email").val())),emailBool=!1,validateEmail($("#reg-email").val())?alertMsg($(".reg-email-feedback-content"),"Email ist nicht valide"):0==t?alertMsg($(".reg-email-feedback-content"),"Email ist vergeben"):(emailBool=!0,changeGlyphyconState($(".reg-email-feedback"),!0),$(".reg-email-feedback-content").html(""))})}),$(".register-form").submit(function(){console.log("dumb"),usernameBool&&passwordBool&&emailBool||(event.preventDefault(),alertMsg($(".reg-submit-feedback-content"),"Bitte fülle alle Felder richtig aus!"))}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.substring(this.length-e.length,this.length)===e}),$(document).ready(function(){if(top.location.pathname.endsWith("dashboard")){console.log("Start PasswordManager");var e=new PasswordManager;e.getFoldersWithDefault(),$("#createPassword").click(function(){e.createPassword()}),$("#createFolder").click(function(){e.createFolder()}),$("#updateFolder").click(function(){e.updateFolder()}),$("#passwordEditModal").on("hidden.bs.modal",function(t){e.clearPasswordEditValues(),$(".btn-passwordEdit-delete").show()}),$("#folderEditModal").on("hidden.bs.modal",function(t){e.clearFolderEditValues(),$(".btn-folderEdit-delete").show()}),$("#passwordEdit-password").on("show.bs.password",function(t){$("#passwordEdit-password").pwstrength("destroy"),$("input.password-strength:password").removeAttr("id"),$("input.password-strength:text").attr("id","passwordEdit-password"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions)}),$("#passwordEdit-password").on("hide.bs.password",function(t){$("#passwordEdit-password").pwstrength("destroy"),$("input.password-strength:text").removeAttr("id"),$("input.password-strength:password").attr("id","passwordEdit-password"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions)}),$(function(){$("[data-toggle='tooltip']").tooltip()})}});
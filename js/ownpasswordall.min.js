function changeGlyphyconState(e,a){e.removeClass("glyphicon glyphicon-remove glyphicon-ok form-bad form-good"),a?e.addClass("glyphicon glyphicon-ok form-good"):e.addClass("glyphicon glyphicon-remove form-bad")}function alertMsg(e,a){$(e).html(""),$('<div class="alert alert-danger">').appendTo(e).html(a)}function validateEmail(e){var a=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return!a.test(e)}function validatePassword(e){var a=/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}/;return!a.test(e)}function PasswordManager(){var e=this;e.passwordstrengthoptions={},e.passwordstrengthoptions.ui={container:"#pwd-container",showVerdictsInsideProgressBar:!0,viewports:{progress:".pwstrength_viewport_progress"}},e.passwordstrengthoptions.common={usernameField:"#passwordEdit-username"},e.passwordstrengthoptions.rules={activated:{wordTwoCharacterClasses:!0,wordRepetitions:!0}},e.ajaxPasswordManagerUrl=scriptPath+"ajax/PasswordManager.php",e.passwordHideContent="****",console.log(e.ajaxPasswordManagerUrl),e.userToken=$("#user-token").val(),e.getFolders=function(a){$("#createPassword").css("visibility","visible"),$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getFolders",userToken:e.userToken}}).done(function(t){$("#folders").html(""),$("#updateFolder").css("visibility","visible");for(var o=JSON.parse(t),s=0;s<o.length;s++)$('<li class="mouse-cursor-pointer">'+o[s].name+"</li>").appendTo("#folders").addClass("folder").attr("data-folder-token-id",o[s].token_id).click(function(){e.openFolder($(this))});a&&($("[data-folder-token-id="+a+"]").addClass("active"),e.showPasswordList(a))})},e.clearFolderEditValues=function(){$("#folderEdit-title").val(""),$("#folderEdit-token").val("")},e.createFolder=function(){$(".btn-folderEdit-delete").hide(),$("#folderEditModal").modal("show"),$(".btn-folderEdit-save").unbind("click"),$(".btn-folderEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"createFolder",userToken:e.userToken,title:$("#folderEdit-title").val()}}).done(function(a){console.log("ADDED Folder");var t=JSON.parse(a);e.getFolders(t),$("#folderEditModal").modal("hide")})})},e.updateFolder=function(){$("#folderEdit-title").val($(".folder.active").html()),$("#folderEdit-token").val($(".folder.active").attr("data-folder-token-id")),$("#folderEditModal").modal("show"),$(".btn-folderEdit-save").unbind("click"),$(".btn-folderEdit-delete").unbind("click"),$(".btn-folderEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"updateFolder",userToken:e.userToken,folderToken:$("#folderEdit-token").val(),title:$("#folderEdit-title").val()}}).done(function(a){console.log("UPDATED Folder");var t=$("#folderEdit-token").val();e.getFolders(t),$("#folderEditModal").modal("hide")})}),$(".btn-folderEdit-delete").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"deleteFolder",userToken:e.userToken,folderToken:$("#folderEdit-token").val()}}).done(function(a){console.log("DELETED Folder"),e.getFoldersWithDefault(),$("#folderEditModal").modal("hide")})})},e.getFoldersWithDefault=function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getDefaultFolder",userToken:e.userToken}}).done(function(a){if("null"!=a){var t=JSON.parse(a);e.getFolders(t.token_id),e.showPasswordList(t.token_id)}else $("#folders").html(""),$("#password-content").html(""),$("#createPassword").css("visibility","hidden"),$("#updateFolder").css("visibility","hidden")})},e.showPasswordList=function(a){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getPasswords",folderToken:a,userToken:e.userToken}}).done(function(a){if($("#password-content").html(""),a)for(var t=JSON.parse(a),o=0;o<t.length;o++)$("#password-content").append('<tr id="passwordParentInChange"><td>'+t[o].title+'</a></td><td><a href="'+t[o].website_url+'" target="_blank">'+t[o].website_url+"</td><td>"+t[o].username+'</td><td id="passwordInChange"><span class="password-content">'+e.passwordHideContent+'</span> <span class="glyphicon glyphicon-eye-open mouse-cursor-pointer" aria-hidden="true" data-toggle="tooltip" title="Show Password"></span></td><td id="passwordEditInChange" align="right"><span class="glyphicon glyphicon-pencil mouse-cursor-pointer" aria-hidden="true" data-toggle="tooltip" title="Edit Password"></span></td></tr>'),$("#passwordInChange").addClass("password").click(function(){e.showPassword($(this))}).removeAttr("id"),$("#passwordParentInChange").attr("data-password-token-id",t[o].token_id).removeAttr("id"),$("#passwordEditInChange").click(function(){e.updatePassword($(this))}).removeAttr("id"),$(function(){$("[data-toggle='tooltip']").tooltip()})})},e.openFolder=function(a){$(".folder").removeClass("active"),a.addClass("active"),e.showPasswordList(a.attr("data-folder-token-id"))},e.showPassword=function(a){e.getPasswordData(a,function(t){a.find(".password-content").html(t.password),setTimeout(function(){a.find(".password-content").html(e.passwordHideContent)},5e3)})},e.getPasswordData=function(a,t){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"getPasswordData",userToken:e.userToken,passwordToken:a.parent().attr("data-password-token-id")}}).done(function(e){var a=JSON.parse(e);t(a)})},e.clearPasswordEditValues=function(){$("#passwordEdit-title").val(""),$("#passwordEdit-website_url").val(""),$("#passwordEdit-username").val(""),$("#passwordEdit-password").val(""),$("#passwordEdit-token").val("")},e.updatePassword=function(a){$(".btn-passwordEdit-save").unbind("click"),$(".btn-passwordEdit-delete").unbind("click"),e.getPasswordData(a,function(t){$("#passwordEditModal").modal("show"),$("#passwordEdit-title").val(t.title),$("#passwordEdit-website_url").val(t.website_url),$("#passwordEdit-username").val(t.username),$("#passwordEdit-password").val(t.password),$("#passwordEdit-token").val(a.parent().attr("data-password-token-id")),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$("#passwordEdit-password").pwstrength("destroy"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$(".btn-passwordEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"updatePassword",userToken:e.userToken,passwordToken:$("#passwordEdit-token").val(),title:$("#passwordEdit-title").val(),website_url:e.convertToUrl($("#passwordEdit-website_url").val()),username:$("#passwordEdit-username").val(),password:$("#passwordEdit-password").val()}}).done(function(a){console.log("EDITED PASSWORD"),e.openFolder($(".folder.active")),$("#passwordEditModal").modal("hide")})}),$(".btn-passwordEdit-delete").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"deletePassword",userToken:e.userToken,passwordToken:$("#passwordEdit-token").val()}}).done(function(a){console.log("DELETED PASSWORD"),e.openFolder($(".folder.active")),$("#passwordEditModal").modal("hide")})})})},e.createPassword=function(){$(".btn-passwordEdit-delete").hide(),$("#passwordEditModal").modal("show"),$(".btn-passwordEdit-save").unbind("click"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$("#passwordEdit-password").pwstrength("destroy"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions),$(".btn-passwordEdit-save").click(function(){$.ajax({method:"POST",url:e.ajaxPasswordManagerUrl,data:{action:"createPassword",userToken:$("#user-token").val(),title:$("#passwordEdit-title").val(),website_url:e.convertToUrl($("#passwordEdit-website_url").val()),folderToken:$(".folder.active").attr("data-folder-token-id"),username:$("#passwordEdit-username").val(),password:$("#passwordEdit-password").val()}}).done(function(a){console.log("ADDED PASSWORDs"),e.openFolder($(".folder.active")),$("#passwordEditModal").modal("hide")})})},e.convertToUrl=function(e){return""!==e?/^https?:\/\//i.test(e)?e:e="http://"+e:void 0}}function alertMsg(e,a){$(e).html(""),$('<div class="alert alert-danger">').appendTo(e).html(a)}function successMsg(e,a){$(e).html(""),$('<div class="alert alert-success">').appendTo(e).html(a)}var scripts=document.getElementsByTagName("script"),path=scripts[scripts.length-1].src.split("?")[0],scriptPath=path.split("/").slice(0,-1).join("/")+"/",authenticationManager=scriptPath+"ajax/AuthenticationManager.php";$(".message a").click(function(){$("form").animate({height:"toggle",opacity:"toggle"},"slow"),$(".messages").html("")});var usernameBool=!1,passwordBool=!1,emailBool=!1;$("#reg-username").on("input",function(){var e=$("#reg-username").val();$.ajax({method:"POST",url:authenticationManager,data:{action:"isUsernameUnique",username:e}}).done(function(a){var t=JSON.parse(a);console.log(t),changeGlyphyconState($(".reg-username-feedback"),!1),usernameBool=!1,e.length<=3?alertMsg($(".reg-username-feedback-content"),"Username ist zu kurz"):t===!1?alertMsg($(".reg-username-feedback-content"),"Username ist vergeben"):(usernameBool=!0,changeGlyphyconState($(".reg-username-feedback"),!0),$(".reg-username-feedback-content").html(""))})}),$("#reg-password").on("input",function(){changeGlyphyconState($(".reg-password-feedback"),!1),console.log(validateEmail($("#reg-password").val())),passwordBool=!1,validatePassword($("#reg-password").val())?alertMsg($(".reg-password-feedback-content"),"Passwort muss mindestens 8 Stellen haben, min. 1 Groß-, 1 Kleinbuchstabe und 1 Zahl."):(passwordBool=!0,changeGlyphyconState($(".reg-password-feedback"),!0),$(".reg-password-feedback-content").html(""))}),$("#reg-email").on("input",function(){$.ajax({method:"POST",url:authenticationManager,data:{action:"isEmailUnique",email:$("#reg-email").val()}}).done(function(e){var a=JSON.parse(e);console.log(a),changeGlyphyconState($(".reg-email-feedback"),!1),console.log(validateEmail($("#reg-email").val())),emailBool=!1,validateEmail($("#reg-email").val())?alertMsg($(".reg-email-feedback-content"),"Email ist nicht valide"):a===!1?alertMsg($(".reg-email-feedback-content"),"Email ist vergeben"):(emailBool=!0,changeGlyphyconState($(".reg-email-feedback"),!0),$(".reg-email-feedback-content").html(""))})}),$(".register-form").submit(function(){console.log("dumb"),usernameBool&&passwordBool&&emailBool||(event.preventDefault(),alertMsg($(".reg-submit-feedback-content"),"Bitte fülle alle Felder richtig aus!"))}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.substring(this.length-e.length,this.length)===e}),$(document).ready(function(){if(top.location.pathname.endsWith("dashboard")){console.log("Start PasswordManager");var e=new PasswordManager;e.getFoldersWithDefault(),$("#createPassword").click(function(){e.createPassword()}),$("#createFolder").click(function(){e.createFolder()}),$("#updateFolder").click(function(){e.updateFolder()}),$("#passwordEditModal").on("hidden.bs.modal",function(a){e.clearPasswordEditValues(),$(".btn-passwordEdit-delete").show()}),$("#folderEditModal").on("hidden.bs.modal",function(a){e.clearFolderEditValues(),$(".btn-folderEdit-delete").show()}),$("#passwordEdit-password").on("show.bs.password",function(a){$("#passwordEdit-password").pwstrength("destroy"),$("input.password-strength:password").removeAttr("id"),$("input.password-strength:text").attr("id","passwordEdit-password"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions)}),$("#passwordEdit-password").on("hide.bs.password",function(a){$("#passwordEdit-password").pwstrength("destroy"),$("input.password-strength:text").removeAttr("id"),$("input.password-strength:password").attr("id","passwordEdit-password"),$("#passwordEdit-password").pwstrength(e.passwordstrengthoptions)}),$(function(){$("[data-toggle='tooltip']").tooltip()})}else top.location.pathname.endsWith("account")&&($(".btn-passwordEdit-save").click(function(){$.ajax({method:"POST",url:scriptPath+"ajax/AuthenticationManager.php",data:{action:"changePassword",userToken:$("#user-token").val(),oldPassword:$("#oldPassword").val(),newPassword1:$("#newPassword1").val(),newPassword2:$("#newPassword2").val()}}).done(function(e){console.log(e),"true"==e?successMsg($(".reg-changePassword-feedback-content"),"Password change was successful!"):alertMsg($(".reg-changePassword-feedback-content"),"Password change failed!")})}),$(".btn-emailEdit-save").click(function(){$.ajax({method:"POST",url:scriptPath+"ajax/AuthenticationManager.php",data:{action:"changeEmail",userToken:$("#user-token").val(),email:$("#email").val()}}).done(function(e){console.log(e),"true"==e?successMsg($(".reg-changeEmail-feedback-content"),"Email change was successful!"):alertMsg($(".reg-changeEmail-feedback-content"),"Email change failed!")})}))});